<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        input[type=text], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 6px;
            margin-bottom: 16px;
            resize: vertical;
        }

        select, input[type=number] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-top: 6px;
            margin-bottom: 16px;
            resize: vertical;
        }

        input[type=submit] {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type=submit]:hover {
            background-color: #45a049;
        }

        button {
            background-color: #e7e7e7;
            color: black;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: darkgray;
        }

        .container {
            border-radius: 5px;
            background-color: #f2f2f2;
            padding: 20px;
        }

        .example_b {
            color: #fff !important;
            text-transform: uppercase;
            text-decoration: none;
            background: #60a3bc;
            padding: 20px;
            border-radius: 50px;
            display: inline-block;
            border: none;
            transition: all 0.4s ease 0s;
        }

        .example_a:hover {
            background: #434343;
            letter-spacing: 1px;
            -webkit-box-shadow: 0px 5px 40px -10px rgba(0, 0, 0, 0.57);
            -moz-box-shadow: 0px 5px 40px -10px rgba(0, 0, 0, 0.57);
            box-shadow: 5px 40px -10px rgba(0, 0, 0, 0.57);
            transition: all 0.4s ease 0s;
        }
    </style>
    <title>Plaintext to Ciphertext</title>
</head>
<body>

<h3>Plaintext to Ciphertext</h3>
<div class="container">
    <form id="form" method="post">

        <label for="country">Encryption method</label>
        <select id="selection" name="encrypt-method" required onchange="hideOtherMethod(); disableDecrypt()">
            <option id="op_caesar" value="caesar">Caesar</option>
            <option id="op_vigenere" value="vigenere">Vigenere</option>
            <option id="op_mono" value="mono">Mono-Alphabetic</option>
        </select>

        <label class="rot">Rotate by: <input class="rot" name="rot" type="number" value="{{ rot }}" id="rot"
                                             oninput="disableDecrypt()"></label>
        <br/>
        <label class="key">Key</label>
        <input type="text" class="key" id="key" name="key" value="{{ key }}"
               maxlength="32" placeholder="letters only please" oninput="disableDecrypt()" pattern="[A-Za-z]{2,}"
               onkeydown="return alphaOnly(event);"
               title="At least two letters, no spaces or special characters. A one letter Vigenere key is just a caesar shift.">

        <label class="alph">Alphabet Used for Mono-Alphabetic Cipher</label>
        <input type="text" class="alph" id="alph" name="alph" value="{{ alpha }}" disabled>

        <label for="plaintext">Plain Text</label>
        <textarea id="plaintext" name="plaintext" placeholder="Enter message to encrypt here..."
                  onkeydown="return alphaOnly(event);" maxlength="255" oninput="disableDecrypt()" pattern="[A-Za-z]{2,}"
                  style="height:100px">{{ plaintext }}</textarea>

        <input type="submit" id="encrypt_button" name="submit_button" value="Encrypt"/>
        <input type="submit" id="decrypt_button" name="submit_button" value="Decrypt"/>

        <input type="submit" id="loadlast" name="submit_button" onClick="makeOkay();" value="Load Last"/>
        <br/><br/>
        <label for="ciphertext">Cipher Text</label>
        <textarea id="ciphertext" name="ciphertext" placeholder="Enter message to decrypt here..."
                  onkeydown="return alphaOnly(event);" maxlength="255" pattern="[A-Za-z]{2,}" oninput="disableDecrypt()"
                  style="height:100px">{{ ciphertext }}</textarea>

        <input type="submit" id="save_button" name="submit_button" value="Save"/>
    </form>

    <script type="text/javascript">
        var msg = "{{ msg }}";
        var l_text = "{{ l_text }}";
        var l_ciphertext = "{{ l_ciphertext }}";
        var l_key = "{{ l_key }}";
        var l_rot = "{{ l_rot }}";
        var l_method = "{{ l_method }}";

        console.log(l_text);

        var selection = document.getElementById("selection");
        var rot_el = document.getElementById("rot");
        var r = rot_el.value;
        var plaintext = document.getElementById("plaintext");
        var pt = plaintext.value;
        var ciphertext = document.getElementById("ciphertext");
        var ct = plaintext.value;
        var key_el = document.getElementById("key");
        var k = key_el.value;
        var last_method = "{{last_method}}";

        rot_class = document.getElementsByClassName("rot");
        key_class = document.getElementsByClassName("key");
        alph_class = document.getElementsByClassName("alph");
        if (last_method == "caesar") {
            op_caesar.selected = true;
        } else if (last_method == "vigenere") {
            op_vigenere.selected = true
        } else if (last_method == "mono") {
            op_mono.selected = true;
        } else {
            last_method = "caesar";
        }
        hideOtherMethod();

        if (msg){
            alert(msg);
        }

        function disableDecrypt() {
            try {
                var new_r = rot_el.value;
                var new_t = plaintext.value;
                var new_k = key_el.value;
                var new_sel = selection.value;
                if (r != new_r || pt != new_t || k != new_k || last_method != new_sel) {
                    document.getElementById("decrypt").disabled = true;
                } else {
                    document.getElementById("decrypt").disabled = false;
                }
            } catch (TypeError) {
            }
        }

        function makeOkay() {
            key_el.required = false;

        }

        function hideOtherMethod() {
            var method = selection.value;
            if (method == "caesar") {
                for (i = 0; i < key_class.length; i++) {
                    key_class[i].hidden = true;
                    rot_class[i].hidden = false;
                    alph_class[i].hidden = true;
                }
                key_el.required = false;
                rot_el.required = true;
            } else if (method == "vigenere") {
                for (i = 0; i < rot_class.length; i++) {
                    rot_class[i].hidden = true;
                    key_class[i].hidden = false;
                    alph_class[i].hidden = true;
                }
                rot_el.required = false;
                key_el.required = true;
            } else if (method == "mono") {
                for (i = 0; i < rot_class.length; i++) {
                    rot_class[i].hidden = true;
                    key_class[i].hidden = true;
                    alph_class[i].hidden = false;
                }
                rot_el.required = false;
                key_el.required = false;
            }
        }

        function alphaOnly(event) {
            var key = event.keyCode;
            return ((key >= 65 && key <= 90) || key == 8);
        };
    </script>
</div>
<br/><br/>
<div class="button_cont" align="center"><a class="example_b" href="/bruteforce" target="_blank" rel="nofollow noopener">Go
    to Brute Force Attack</a></div>
</body>
</html>
